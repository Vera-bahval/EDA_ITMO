# Анализ данных о мошеннических транзакциях

## Описание проекта

Разведочный анализ данных (EDA) 7.48M реальных финансовых транзакций за октябрь 2024 для выявления паттернов мошенничества и разработки продуктовых и технических гипотез.

**Ключевые характеристики датасета:**
- 7,483,766 транзакций за период 30.09.2024 - 30.10.2024
- Fraud rate: 19.97% (1,494,719 мошеннических операций)
- 11 валют, 12 стран, 8 категорий вендоров
- Реал-тайм признаки активности за последний час

---

## Методология решения задачи

### Подход к анализу данных
Для решения задачи применялся системный подход:

1. **Поэтапное исследование данных**
   - Начали с базовой статистики и структуры данных
   - Проверили качество данных и отсутствующие значения
   - Изучили распределение целевой переменной (fraud rate: 19.97%)

2. **Итеративный анализ паттернов**
   - Временные паттерны: анализ по часам, дням недели
   - Географические закономерности: страны, операции вне дома
   - Категориальный анализ: устройства, каналы, типы вендоров
   - Численный анализ: суммы транзакций с конвертацией в USD

3. **Выявление аномалий и критических находок**
   - POS-терминалы с 100% fraud rate (требует проверки данных)
   - Микротранзакции <$10 с 99.5% fraud rate
   - Ночные операции с 59% fraud rate vs 10% днем

### Инструменты и технологии

**Основной стек:**
- `pandas`
- `numpy`
- `matplotlib/seaborn`
- `jupyter notebooks`

### Процесс принятия решений

**1. Валидация находок на данных**
- Каждый инсайт проверялся на статистическую значимость
- Использовались группировки и агрегации для подтверждения паттернов
- Проводилось сравнение fraud rate между сегментами

**2. Бизнес-ориентированный подход**
- Находки переводились в конкретные продуктовые гипотезы
- Оценивался потенциальный impact каждого решения

**3. Критический подход**
- Выявление аномалий в данных (100% fraud для POS)
- Формулирование вопросов к качеству данных

### Особенности работы с данными

**Challenges и их решения:**
- **Большой объем данных** (7.48M записей) → использование sample для демонстрации сложных вычислений
- **Вложенная структура** `last_hour_activity` → применение `pd.json_normalize()`
- **Множество валют** → конвертация в USD через исторические курсы
- **Высокий fraud rate** (19.97%) → фокус на наиболее критичные паттерны

---

## Ключевые находки

### Критические аномалии в данных
1. **POS-терминалы показывают 100% fraud rate** - требует проверки качества данных
2. **Микротранзакции (<$10) имеют 99.5% fraud rate** - возможные тестовые атаки
3. **Высокие суммы (>$5000) показывают 100% fraud rate** - подозрительная закономерность

### Четкие паттерны мошенничества
- **Временной паттерн**: Ночные часы (1-4) дают 59% fraud vs 10% днем (5.6x разница)
- **География**: Некоторые страны показывают 37% fraud vs 7% в развитых (5.2x разница)  
- **Локация**: Операции вне домашней страны дают 57% vs 2.5% дома (22.8x разница)
- **Комбинированный риск**: Ночь + вне дома + >$1000 = **96% fraud rate**

---

## Продуктовые гипотезы

### 1. ГИПОТЕЗА О ВРЕМЕННЫХ ЛИМИТАХ

#### Исходные данные:
```
Fraud rate по часам:
hour 0:  41,519 / 155,759 = 26.7%
hour 1:  165,999 / 280,136 = 59.3% ← ПИК
hour 2:  166,025 / 280,472 = 59.2% ← ПИК  
hour 3:  165,621 / 280,031 = 59.1% ← ПИК
hour 4:  166,418 / 281,466 = 59.1% ← ПИК

vs дневные часы:
hour 8:  41,523 / 405,312 = 10.2%
hour 12: 41,716 / 404,942 = 10.3%
hour 18: 41,400 / 456,393 = 9.1%
```

#### Анализ паттерна:
- **Ночной период (1-4 часа)**: ~59% fraud rate
- **Дневной период (7-19 часов)**: ~10% fraud rate  
- **Разница**: 59% / 10% = **5.9x больше риска ночью**

### Объем проблемы:
- Ночных транзакций: 280k × 4 часа = ~1.1M
- Из них мошеннических: ~650k транзакций
- При среднем ущербе $875 = **$568M потерь только за ночь**

**Продуктовая гипотеза**: Внедрение динамических лимитов по времени суток позволит снизить потери от мошенничества на 40-50%

**Решение:**

1. Автоматическое снижение лимитов на 70% в период 01:00-05:00
2. Обязательная дополнительная аутентификация для операций >$500 ночью
3. Push-уведомления клиентам о подозрительной ночной активности

### 2. ГИПОТЕЗА О МИКРОПЛАТЕЖАХ

#### Исходные данные:
```
Fraud rate по категориям сумм (USD):
micro (<$10):      450,045 / 452,527 = 99.5% ← КРИТИЧНО!
very_low ($10-50): 27,058 / 204,679 = 13.2%
low ($50-200):     122,232 / 1,505,610 = 8.1%
medium ($200-1000): 412,606 / 4,252,642 = 9.7%
```

#### Анализ паттерна:
- **452,527 микротранзакций** - из них **450,045 мошеннических**
- Это **99.5% fraud rate** vs **9.7%** для обычных сумм
- Разница: **10.3x больше риска** для микросумм

#### Интерпретация паттерна:
1. **Легитимные пользователи** почти не делают операции <$10
2. **Мошенники** массово тестируют украденные карты малыми суммами
3. **Тестирование перед крупными операциями** - классическая схема card testing

**Продуктовая гипотеза:** Блокировка серий микроплатежей предотвратит 450k мошеннических операций в месяц

**Решение:**

1. Блокировка карты после 3 операций <$10 за час
2. Обязательное SMS-подтверждение для операций <$5
3. Выделенный канал обработки микроплатежей с повышенной проверкой

### 3. ГИПОТЕЗА О ГЕОЛОКАЦИИ

#### Исходные данные:
```
is_outside_home_country:
False (дома): fraud_rate = 2.49%
True (за границей): fraud_rate = 56.78%

Топ стран по fraud rate:
Mexico:   298,841 / 785,704 = 38.0%
Russia:   299,425 / 793,730 = 37.7%  
Brazil:   298,629 / 804,800 = 37.1%
Nigeria:  298,600 / 849,840 = 35.1%

vs безопасные страны:
Singapore: 37,414 / 588,668 = 6.4%
France:    37,426 / 541,287 = 6.9%
UK:        37,345 / 538,493 = 6.9%
```

#### Корреляционный анализ:
- **Операции дома**: 2.49% fraud rate
- **Операции за границей**: 56.78% fraud rate
- **Множитель риска**: 56.78% / 2.49% = **22.8x**

#### Сегментация по странам:
- **Группа высокого риска** (4 страны): ~37% fraud rate
- **Группа низкого риска** (8 стран): ~7% fraud rate
- **Разница в риске**: 5.3x

#### Причинно-следственная связь:
**ПРИЧИНА**: Мошенники используют украденные карты в странах с:
- Слабым банковским контролем
- Высоким уровнем киберпреступности  
- Сложностями международного расследования

**СЛЕДСТВИЕ**: Кардинальное увеличение риска при смене географии

**Продуктовая гипотеза:** Блокировка операций при первой транзакции в новой стране до подтверждения клиентом снизит fraud на 35%

**Решение:**

1. Предварительная регистрация поездок в мобильном приложении
2. Мгновенная блокировка карты при первой операции в новой стране
3. Экспресс-разблокировка через биометрию в приложении за 30 секунд

### 4. ГИПОТЕЗА О POS-ТЕРМИНАЛАХ

#### Исходные данные:
```
Fraud rate по устройствам:
Chip Reader:      217,324 / 217,324 = 100.0% ← КРИТИЧНО!
NFC Payment:      216,519 / 216,519 = 100.0% ← КРИТИЧНО!
Magnetic Stripe:  217,204 / 217,204 = 100.0% ← КРИТИЧНО!

vs цифровые каналы:
Firefox:  142,171 / 1,120,952 = 12.7%
Safari:   141,379 / 1,120,245 = 12.6%
Chrome:   140,087 / 1,132,384 = 12.4%
```

#### Анализ паттерна:
- **ВСЕ** физические POS-операции (651,047) = мошеннические
- **Цифровые** операции: ~12.5% fraud rate
- **Соотношение**: 100% vs 12.5% = **8x разница**

#### Техническая интерпретация:
1. **100% fraud rate физически невозможен** для легитимных терминалов
2. **Все POS-устройства скомпрометированы** или данные содержат только мошеннические POS-операции
3. **Скимминг или поддельные терминалы** - массовая проблема

**Продуктовая гипотеза:** Создание "белого списка" проверенных терминалов и блокировка подозрительных точек снизит физическое мошенничество до 5%

**Решение:**

1. Система репутации торговых точек на основе истории операций
2. Автоматическая блокировка терминалов с >50% fraud rate
3. Партнерская программа для верификации честных мерчантов

### 5. ГИПОТЕЗА О ПЕРСОНАЛИЗАЦИИ

#### Исходные данные:
```
Корреляции с is_fraud:
hour:                    -0.280 (сильная)
amount_usd:              +0.228 (умеренная)
last_hour_activity:      +0.009 (слабая)

Медианы сумм:
Легитимные: $355
Мошеннические: $443
Разница: 25% больше у fraud
```

#### Анализ поведенческих паттернов:
```
last_hour_activity статистика:
                      Легитимные    Мошеннические
num_transactions:     408.3         412.7
total_amount:         $19.9M        $20.2M  
unique_merchants:     Similar       Similar
max_single_amount:    $1.72M        $1.75M
```

#### Выводы о персонализации:
1. **Время** - самый сильный предиктор (-0.280 корреляция)
2. **Сумма** - второй по важности (+0.228 корреляция)  
3. **Активность за час** слабо различается между группами
4. **Индивидуальные паттерны** важнее абсолютных значений

**Продуктовая гипотеза:** Динамические лимиты на основе истории снизят false positive на 60% и улучшат UX

**Решение:**

1. ML-модель для расчета персональных лимитов на основе истории
2. Автоматическое повышение лимитов для лояльных клиентов
3. Градуальное снижение лимитов при подозрительном поведении
   
---

## Технические гипотезы

### 1. Feature engineering для временных паттернов
**Идея**: Создать advanced временные признаки

**Признаки**:
- `is_suspicious_hour` (1-4 AM = True)
- `hours_since_last_transaction`
- `transaction_velocity_1h` (количество за час)
- `unusual_timing_score` (отклонение от паттерна клиента)

**Ожидание**: Улучшение precision ML-модели 

### 2. Геолокационная модель риска
**Идея**: Создать risk score для комбинаций стран/городов

**Подход**:
- Кластеризация стран по fraud rate
- Проработать модель расстояния от домашней страны
- Risk score для city_size + country комбинаций

**Ожидание**: Выявление новых геолокационных паттернов

### 3. Graph-based анализ устройств
**Проблема**: Мошенники используют одни device fingerprints

**Решение**:
- Граф связей device_fingerprint ↔ customer_id
- Детекция аномальных паттернов в графе
- Blacklist подозрительных fingerprints

**Ожидание**: Обнаружение организованного мошенничества

---

## Критические вопросы к данным
1. **POS-терминалы с 100% fraud** - ошибка разметки или реальная проблема?
2. **Микротранзакции с 99.5% fraud** - это тестовые атаки или ошибки в данных?
3. **Отсутствие seasonality** - почему fraud rate стабилен по дням?

### Гипотезы о качестве данных:
- Возможная проблема с labeling для физических транзакций
- Микротранзакции могут быть automated attacks
- Некоторые "fraud" могут быть legitimate disputed transactions
